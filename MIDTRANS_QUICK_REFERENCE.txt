â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   MIDTRANS CORE API - QUICK REFERENCE CARD                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Œ KEY ENDPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST   /midtrans/notification        â† Webhook from Midtrans (CRITICAL)
GET    /midtrans/finish              â† User returns after payment (Core API)
GET    /midtrans/unfinish            â† User returns, payment pending
GET    /midtrans/error               â† User returns, payment failed

GET    /payment/{code}               â† Customer views payment instructions
GET    /order/{orderNumber}          â† Customer views order details


ğŸ”„ PAYMENT STATUS FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Order Created
    â†“ payment_status: 'pending'
    â†“ status: 'pending'

Payment Created via Core API
    â†“ payment.transaction_status: 'pending'

Customer Pays at Bank
    â†“ Midtrans sends webhook

Order Updated (On Webhook)
    â†“ IF transaction_status = 'settlement' OR 'capture' AND fraud_status = 'accept':
    â”‚  â””â”€ payment_status: 'paid'
    â”‚  â””â”€ status: 'processing'
    â”‚  â””â”€ paid_at: NOW()
    â”‚
    â†“ IF transaction_status = 'deny' OR 'cancel' OR 'expire':
       â””â”€ payment_status: 'failed'
       â””â”€ status: 'payment_failed'


ğŸ’¾ CRITICAL DATABASE TABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ORDERS
  â”œâ”€ order_number ..................... 'ORD-20251216-ABC123'
  â”œâ”€ payment_status ................... 'pending' | 'paid' | 'failed'
  â”œâ”€ status ........................... 'pending' | 'processing' | 'payment_failed'
  â”œâ”€ paid_at .......................... DateTime when payment confirmed
  â””â”€ (other fields...)

PAYMENTS
  â”œâ”€ order_id ......................... FK to orders
  â”œâ”€ transaction_id ................... From Midtrans
  â”œâ”€ transaction_status ............... 'pending'|'settlement'|'capture'|'deny'|'cancel'|'expire'
  â”œâ”€ fraud_status ..................... 'accept'|'deny'|null
  â”œâ”€ payment_type ..................... 'bank_transfer'|'echannel'|'gopay'|etc
  â”œâ”€ payment_channel .................. 'bca'|'bni'|'bri'|'gopay'|etc
  â”œâ”€ gross_amount ..................... Transaction amount in IDR
  â”œâ”€ midtrans_response ................ Full JSON from Midtrans
  â”œâ”€ signature_key .................... For webhook validation
  â””â”€ (other fields...)

PAYMENT_NOTIFICATIONS
  â”œâ”€ payment_id ....................... FK to payments
  â”œâ”€ order_id ......................... From notification order_id
  â”œâ”€ transaction_status ............... Notification status
  â”œâ”€ notification_body ................ Full webhook JSON
  â”œâ”€ processed ........................ Boolean flag
  â””â”€ processed_at ..................... DateTime when processed


ğŸ” WEBHOOK SIGNATURE VALIDATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Every notification from Midtrans includes:
  â€¢ order_id
  â€¢ status_code
  â€¢ gross_amount
  â€¢ signature_key

Validation Formula:
  SIGNATURE = SHA512(order_id + status_code + gross_amount + SERVER_KEY)
  
  If SIGNATURE != provided signature_key:
    âœ— REJECT notification
    âœ“ LOG warning
  Else:
    âœ“ ACCEPT and process


âš¡ PAYMENT INSTRUCTION TYPES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Virtual Account (bank_transfer)
  â”œâ”€ bank: 'bca' | 'bni' | 'bri' | 'mandiri'
  â”œâ”€ va_number: '12345678901234567890'
  â””â”€ instructions: Step-by-step payment guide

E-Channel (echannel)
  â”œâ”€ bill_key: '...'
  â”œâ”€ biller_code: '...'
  â””â”€ instructions: Mandiri-specific steps

QRIS (qris)
  â”œâ”€ qr_string: '<base64 encoded QR>'
  â”œâ”€ expiry_time: DateTime
  â””â”€ actions: Array of provider actions

E-Wallet (gopay, shopeepay, dana, ovo, linkaja)
  â”œâ”€ provider: 'gopay' | 'shopeepay' | etc
  â”œâ”€ actions: Array of deeplinks
  â””â”€ instructions: Provider-specific steps

Credit Card (credit_card)
  â””â”€ instructions: CVV, 3D Secure info


ğŸ”§ COMMON OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Check Payment Status:
  $midtransService = new MidtransService();
  $result = $midtransService->getTransactionStatus('ORD-20251216-ABC123');

Create Payment:
  $result = $midtransService->createTransaction($order, 'bank-transfer-bca');
  
  Response:
  {
    "success": true,
    "data": { /* Midtrans response */ },
    "payment_instructions": { /* Formatted for UI */ },
    "payment_id": 123,
    "redirect_url": "..."
  }

Update Payment from Notification:
  $payment->updateFromMidtransNotification($notificationArray);
  // Automatically updates order status too

Check if Payment Successful:
  if ($payment->isSuccessful()) {
    // Mark order as paid
  }

Verify Order is Paid:
  if ($order->isPaid()) {
    // Process fulfillment
  }


ğŸš¨ ERROR SCENARIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Server Key Missing:
  Problem: MIDTRANS_SERVER_KEY not in .env
  Solution: Add to .env and run `php artisan config:cache`

Invalid Signature:
  Problem: Signature validation fails
  Solution: Verify MIDTRANS_SERVER_KEY matches Midtrans dashboard
  Check: Logs show "Invalid Midtrans signature"

Webhook Not Received:
  Problem: notification_url not publicly accessible
  Solution: For local dev, use ngrok: ngrok http 8000
  Then set: MIDTRANS_NOTIFICATION_URL=https://your-ngrok-id.ngrok.io/midtrans/notification

Order Not Found:
  Problem: webhook has wrong order_id
  Solution: Verify order_number format matches what was sent to Midtrans

Payment Not Updating:
  Problem: transaction_status not 'settlement' or 'capture'
  Solution: Check fraud_status is 'accept' or null
  Verify: SELECT * FROM payments WHERE order_id = ?

Order Status Stuck on 'pending':
  Problem: Webhook processed but order not updated
  Solution: Check Payment::updateFromMidtransNotification() was called
  Check: Logs show "Payment updated from notification"


ğŸ“‹ LOGGING KEYWORDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Search logs for:
  âœ“ "Midtrans Core API Request"      â†’ Payment creation started
  âœ“ "Midtrans Core API Response"     â†’ Payment creation succeeded
  âœ“ "Payment notification created"   â†’ Webhook received
  âœ“ "Payment updated from notification" â†’ Status update succeeded
  âœ“ "Invalid Midtrans signature"     â†’ Security issue detected
  âœ“ "Order not found"                â†’ Data mismatch
  âœ“ "Midtrans notification processing error" â†’ Something went wrong


ğŸ“ ROUTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Web Routes (in routes/web.php):
  
  Route::post('/midtrans/notification', ...) â†’ MidtransController@notification
  Route::get('/midtrans/finish', ...)         â†’ MidtransController@finish
  Route::get('/midtrans/unfinish', ...)       â†’ MidtransController@unfinish
  Route::get('/midtrans/error', ...)          â†’ MidtransController@error
  
  Route::get('/payment/{code}', ...)          â†’ Payment Livewire
  Route::get('/order/{orderNumber}', ...)     â†’ OrderDetail Livewire


ğŸ¯ ENVIRONMENT VARIABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Required:
  MIDTRANS_SERVER_KEY                      (from Midtrans dashboard)
  MIDTRANS_CLIENT_KEY                      (from Midtrans dashboard)
  MIDTRANS_IS_PRODUCTION                   (false for sandbox, true for live)

Optional:
  MIDTRANS_NOTIFICATION_URL                (default: /midtrans/notification)
  MIDTRANS_CURRENCY                        (default: IDR)
  MIDTRANS_TRANSACTION_TIMEOUT             (default: 30 minutes)


ğŸ NEXT STEPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Add credentials to .env file
2. Run: php artisan config:cache
3. Test order creation through checkout
4. Verify payment record created
5. Simulate webhook notification
6. Verify order marked as paid
7. Deploy to production with live credentials
8. Monitor logs for first 24 hours
9. Set up error tracking (Sentry, etc.)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Last Updated: December 16, 2025
Version: 1.0 - Core API Only
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
